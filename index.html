<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Nuestra App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">


<style>
body{
  margin:0;
  font-family:'Quicksand', sans-serif;
  background:#f2f2f2;
}
.hidden{display:none}
header{background:#111;color:#fff;padding:10px;display:flex;align-items:center}
#menuBtn{font-size:22px;cursor:pointer}
nav{
position:fixed;top:0;left:0;width:260px;height:100%;
background:#222;color:#fff;padding:15px;
transform:translateX(-100%);transition:.3s;z-index:10
}
nav.open{transform:translateX(0)}
#overlay{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.4);display:none;z-index:5
}
nav img{width:80px;height:80px;border-radius:50%}
section{padding:15px}
.menu{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}

.menu div{background:#fff;padding:20px;border-radius:10px;text-align:center;cursor:pointer}
.card{background:#fff;padding:10px;margin:8px 0;border-radius:8px}
input,textarea{width:100%;padding:6px;margin:4px 0}
button{padding:6px 10px;margin-top:5px}
.userBox{display:flex;align-items:center;gap:10px}
.userBox img{width:50px;height:50px;border-radius:50%}
.circle{
width:60px;height:60px;border-radius:50%;
background:conic-gradient(#4caf50 0deg, #ddd 0deg);
display:flex;align-items:center;justify-content:center;
font-size:12px
}
/* LOGIN DISE√ëO */
#loginScreen{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  min-height:100vh;
  z-index:100;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:
    radial-gradient(circle at 20% 20%, #f7e8d5 0%, transparent 40%),
    radial-gradient(circle at 80% 30%, #f3dcc2 0%, transparent 45%),
    radial-gradient(circle at 50% 80%, #f8efe4 0%, transparent 50%),
    #f6eadb;
}
  
#loginScreen h2{
  margin-bottom:20px;
  font-weight:600;
  font-size:26px;
}

#loginScreen input{
  width:260px;
  max-width:80%;
  border:none;
  border-radius:20px;
  padding:10px 14px;
  margin:6px 0;
  font-size:14px;
}

#loginScreen button{
  margin-top:15px;
  padding:10px 30px;
  border:none;
  border-radius:25px;
  background:#d8bfa3;
  color:#333;
  font-size:15px;
  cursor:pointer;
}
body.login-active{
  overflow:hidden;
}
#loginScreen form{
  display:flex;
  flex-direction:column;
  align-items:center;
}
#photo{
  display:none;
}
.photoPicker{
  width:80px;
  height:80px;
  border-radius:50%;
  background:#d8bfa3;
  color:#333;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  cursor:pointer;
  margin:10px 0;
  overflow:hidden;
}

.photoPicker img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.headerPhotoPicker{
  width:40px;
  height:40px;
  border-radius:50%;
  background:#d8bfa3;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  overflow:hidden;
  margin-left:10px;
}

.headerPhotoPicker input{
  display:none;
}

.headerPhotoPicker img{
  width:100%;
  height:100%;
  object-fit:cover;
}

#headerPlus{
  font-size:22px;
  color:#333;
}
</style>
</head>

<body>

<div id="overlay" onclick="closeMenu()"></div>

<!-- LOGIN -->
<section id="loginScreen">
<h2>Bienvenido/a üíõ</h2>
<form onsubmit="event.preventDefault(); login();">
  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Contrase√±a (6+)">
  <input id="name" placeholder="Nombre">

<label class="photoPicker">
  <span id="photoPlus">+</span>
  <img id="photoPreview" class="hidden">
  <input type="file" id="photo" accept="image/*" onchange="previewPhoto(event)">
</label>

  <button onclick="login()">Entrar / Registrarse</button>
</form>
</section>

<!-- APP -->
<div id="app" class="hidden">

<header>
  <span id="menuBtn" onclick="openMenu()">‚ò∞</span>

  <label class="headerPhotoPicker">
    <img id="headerPhoto" class="hidden">
    <span id="headerPlus">+</span>
    <input type="file" accept="image/*" onchange="updatePhoto(event)">
  </label>

  <h3 style="margin-left:10px">Nuestra App</h3>
</header>

<nav id="sideMenu">
<button onclick="closeMenu()">Cerrar ‚úñ</button>
<img id="profilePic">
<p id="profileName"></p>
<input type="file" onchange="updatePhoto(event)">
<button onclick="logout()">Salir</button>
</nav>

<section class="menu">
<div onclick="openObjetivos()">üéØ Objetivos</div>
<div onclick="openList('planes')">üìÖ Planes</div>
<div onclick="openList('restaurantes')">üçΩÔ∏è Restaurantes</div>
<div onclick="openList('sitios')">üìç Sitios</div>
</section>

<section id="content"></section>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA-RGOYwDqQ5zwAiTHElbSOAgOUKr1AYAM",
  authDomain: "app-8e3d0.firebaseapp.com",
  projectId: "app-8e3d0",
  storageBucket: "app-8e3d0.firebasestorage.app",
  messagingSenderId: "1013704877946",
  appId: "1:1013704877946:web:3b6f409f7fa1cc3f0058c3"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();
let user;

// LOGIN
function login(){
auth.signInWithEmailAndPassword(email.value,pass.value)
.catch(()=>{
auth.createUserWithEmailAndPassword(email.value,pass.value)
.then(r=>{
let file=photo.files[0];
let ref=storage.ref("profiles/"+r.user.uid);
if(file){
ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
db.collection("users").doc(r.user.uid).set({name:name.value,photo:url});
profilePic.src = url;
}));
}else{
db.collection("users").doc(r.user.uid).set({name:name.value,photo:""});
}
});
});
}

auth.onAuthStateChanged(u=>{
  if(u){
    user = u;
    loginScreen.style.display = "none";
    app.classList.remove("hidden");
    loadProfile();
  }else{
    loginScreen.style.display = "flex";
    app.classList.add("hidden");
  }
});

// PERFIL
function loadProfile(){
db.collection("users").doc(user.uid).onSnapshot(d=>{
profileName.innerText=d.data().name;
profilePic.src=d.data().photo||"https://via.placeholder.com/80";

// FOTO HEADER
if(d.data().photo){
  headerPhoto.src = d.data().photo;
  headerPhoto.classList.remove("hidden");
  headerPlus.classList.add("hidden");
}
});
}
function updatePhoto(e){
let file=e.target.files[0];
let ref=storage.ref("profiles/"+user.uid);
ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
db.collection("users").doc(user.uid).update({photo:url});
}));
}

// MENU
function openMenu(){sideMenu.classList.add("open");overlay.style.display="block";}
function closeMenu(){sideMenu.classList.remove("open");overlay.style.display="none";}
function logout(){auth.signOut();}

// OBJETIVOS
function openObjetivos(){
document.querySelector(".menu").classList.add("hidden");

content.innerHTML = `
  <button onclick="goBack()">‚¨Ö Volver</button>
  <h3>Objetivos del a√±o</h3>
  <div id="users"></div>
`;

db.collection("users").onSnapshot(us=>{
users.innerHTML="";
us.forEach(u=>{
let uid=u.id;
let data=u.data();
let box=document.createElement("div");
box.className="card";
box.innerHTML=`
<div class="userBox">
<img src="${data.photo||'https://via.placeholder.com/50'}">
<b>${data.name}</b>
<div class="circle" id="c_${uid}">0%</div>
</div>
<input placeholder="Nuevo objetivo" id="o_${uid}">
<button onclick="addObj('${uid}')">A√±adir</button>
<div id="l_${uid}"></div>
`;
users.appendChild(box);

db.collection("objetivos").where("uid","==",uid).onSnapshot(s=>{
let total=0,done=0;
let list=document.getElementById("l_"+uid);
list.innerHTML="";
s.forEach(d=>{
let o=d.data();total++;if(o.done)done++;
list.innerHTML+=`
<div>
<input type="checkbox" ${o.done?"checked":""}
onclick="toggleObj('${d.id}',${!o.done})">
${o.text}
</div>`;
});
let pct=total?Math.round(done/total*100):0;
document.getElementById("c_"+uid).style.background=
`conic-gradient(#4caf50 ${pct*3.6}deg,#ddd 0deg)`;
document.getElementById("c_"+uid).innerText=pct+"%";
});
});
});
}
function addObj(uid){
let i=document.getElementById("o_"+uid);
db.collection("objetivos").add({uid,text:i.value,done:false});
i.value="";
}
function toggleObj(id,val){db.collection("objetivos").doc(id).update({done:val});}

// LISTAS
function openList(type){
 enterSection();

  content.innerHTML = `
    <button onclick="goBack()">‚¨Ö Volver</button>
    <h3>${type}</h3>
    <textarea id="txt" placeholder="Texto o enlace"></textarea>
    <input type="file" id="img" accept="image/*">
    <button onclick="addItem('${type}')">A√±adir</button>
    <div id="list"></div>
  `;

const list = document.getElementById("list");

  db.collection(type).onSnapshot(s=>{
    list.innerHTML="";
    s.forEach(d=>{
      let i=d.data();
      list.innerHTML+=`
        <div class="card">
          ${i.text||""}<br>
          ${i.img ? `<img src="${i.img}" style="width:100%">` : ""}
          <br>
          <input type="checkbox" ${i.done?"checked":""}
          onclick="toggle('${type}','${d.id}',${!i.done})">
          <a href="https://calendar.google.com" target="_blank">üìÖ</a>
        </div>
      `;
    });
  });
}

function addItem(type){
let file = document.getElementById("img").files[0];
if(file){
let ref=storage.ref(type+"/"+Date.now());
ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
db.collection(type).add({text:txt.value,img:url,done:false});
}));
}else{
db.collection(type).add({text:txt.value,done:false});
}
document.getElementById("txt").value = "";
document.getElementById("img").value = "";
}
function toggle(type,id,val){db.collection(type).doc(id).update({done:val});}
function previewPhoto(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    photoPreview.src = reader.result;
    photoPreview.classList.remove("hidden");
    photoPlus.classList.add("hidden");
  };
  reader.readAsDataURL(file);
}

function enterSection(){
  document.querySelector(".menu").classList.add("hidden");
  document.querySelector("header").classList.add("hidden");
}

function exitSection(){
  document.querySelector(".menu").classList.remove("hidden");
  document.querySelector("header").classList.remove("hidden");
  content.innerHTML = "";
}

</script>

</body>
</html>
