<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Nuestra App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; margin:0; background:#f4f4f4; }
.hidden { display:none; }
header { background:#222; color:#fff; padding:10px; display:flex; align-items:center; }
#menuBtn { font-size:22px; cursor:pointer; margin-right:10px; }
nav { position:fixed; top:0; left:0; width:250px; height:100%; background:#333; color:#fff; padding:20px; transform:translateX(-100%); transition:.3s; }
nav.open { transform:translateX(0); }
nav img { width:80px; height:80px; border-radius:50%; }
section { padding:15px; }
.card { background:#fff; padding:10px; margin-bottom:10px; border-radius:8px; }
button { padding:6px 10px; }
input { width:100%; padding:6px; margin:4px 0; }
.menu { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
.menu div { background:#fff; padding:20px; text-align:center; border-radius:10px; cursor:pointer; }
</style>
</head>

<body>

<!-- LOGIN -->
<section id="login">
<h2>Entrar</h2>
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Contrase√±a">
<input id="name" placeholder="Nombre (opcional)">
<button onclick="login()">Entrar / Registrarse</button>
</section>

<!-- APP -->
<div id="app" class="hidden">

<header>
<span id="menuBtn" onclick="toggleMenu()">‚ò∞</span>
<h3>Nosotros</h3>
</header>

<nav id="sideMenu">
<img id="profilePic">
<p id="profileName"></p>
<input type="file" onchange="uploadPhoto(event)">
<button onclick="logout()">Salir</button>
</nav>

<section class="menu">
<div onclick="openSection('objetivos')">üéØ Objetivos</div>
<div onclick="openSection('planes')">üìÖ Planes</div>
<div onclick="openSection('restaurantes')">üçΩÔ∏è Restaurantes</div>
<div onclick="openSection('sitios')">üìç Sitios</div>
</section>

<section id="content"></section>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA-RGOYwDqQ5zwAiTHElbSOAgOUKr1AYAM",
  authDomain: "app-8e3d0.firebaseapp.com",
  projectId: "app-8e3d0",
  storageBucket: "app-8e3d0.firebasestorage.app",
  messagingSenderId: "1013704877946",
  appId: "1:1013704877946:web:3b6f409f7fa1cc3f0058c3"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let user;

// LOGIN
function login(){
auth.signInWithEmailAndPassword(email.value, pass.value)
.catch(()=>{
auth.createUserWithEmailAndPassword(email.value, pass.value)
.then(r=>{
db.collection("users").doc(r.user.uid).set({
name:name.value,
photo:""
});
});
});
}

auth.onAuthStateChanged(u=>{
if(u){
user=u;
login.style.display="none";
app.classList.remove("hidden");
loadProfile();
}else{
login.style.display="block";
app.classList.add("hidden");
}
});

// PERFIL
function loadProfile(){
db.collection("users").doc(user.uid).onSnapshot(d=>{
profileName.innerText=d.data().name || "Sin nombre";
profilePic.src=d.data().photo || "https://via.placeholder.com/80";
});
}

function uploadPhoto(e){
let file=e.target.files[0];
let ref=storage.ref("photos/"+user.uid);
ref.put(file).then(()=>{
ref.getDownloadURL().then(url=>{
db.collection("users").doc(user.uid).update({photo:url});
});
});
}

// MENU
function toggleMenu(){ sideMenu.classList.toggle("open"); }
function logout(){ auth.signOut(); }

// SECCIONES
function openSection(type){
content.innerHTML=`
<h3>${type}</h3>
<input id="newItem" placeholder="A√±adir">
<button onclick="addItem('${type}')">A√±adir</button>
<div id="list"></div>`;
db.collection(type).onSnapshot(s=>{
list.innerHTML="";
s.forEach(d=>{
let c=d.data();
list.innerHTML+=`
<div class="card">
<input type="checkbox" ${c.done?"checked":""}
onclick="toggle('${type}','${d.id}',${!c.done})">
${c.text}
<button onclick="del('${type}','${d.id}')">‚ùå</button>
</div>`;
});
});
}

function addItem(type){
db.collection(type).add({text:newItem.value,done:false});
newItem.value="";
}
function toggle(type,id,val){
db.collection(type).doc(id).update({done:val});
}
function del(type,id){
db.collection(type).doc(id).delete();
}
</script>

</body>
</html>
